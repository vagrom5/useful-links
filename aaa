#include <stdio.h>
#include <string.h>
#include <stdlib.h>

void array_to_string(double* arr, int length, char* buffer, int buffer_size) {
    int pos = 0;
    for (int i = 0; i < length; i++) {
        // Преобразуем текущий double в строку
        int written = snprintf(buffer + pos, buffer_size - pos, "%.15g", arr[i]);
        
        // Проверяем, не вышли ли за пределы буфера
        if (written < 0 || written >= buffer_size - pos) {
            // Буфер переполнен, можно обработать ошибку
            break;
        }
        pos += written;
        
        // Добавляем запятую, если это не последний элемент
        if (i < length - 1) {
            if (pos + 1 < buffer_size) {
                buffer[pos++] = ',';
                buffer[pos] = '\0'; // Всегда поддерживаем нуль-терминатор
            } else {
                break; // Не хватает места для запятой
            }
        }
    }
}

int main() {
    double numbers[] = {1.23, 4.56, 7.89, 0.123456789};
    int count = sizeof(numbers) / sizeof(numbers[0]);
    
    // Оцениваем необходимый размер буфера (каждый double может занять до 24 символов + запятые)
    int needed_size = count * 24 + 1; // +1 для нуль-терминатора
    char* buffer = (char*)malloc(needed_size);
    
    if (buffer == NULL) {
        perror("Ошибка выделения памяти");
        return 1;
    }
    
    buffer[0] = '\0'; // Инициализируем пустую строку
    
    array_to_string(numbers, count, buffer, needed_size);
    
    printf("Результат: %s\n", buffer);
    
    free(buffer);
    return 0;
}